<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<title>02 ç³»ç»Ÿæ¶æ„ - Mermaid é¢„è§ˆ</title>
<script src="https://cdn.jsdelivr.net/npm/mermaid@11/dist/mermaid.min.js"></script>
<style>
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body { 
    font-family: 'Segoe UI', sans-serif; 
    background: #0f172a; 
    color: #e2e8f0; 
    padding: 40px 60px;
  }
  h1 { 
    text-align: center; 
    font-size: 2rem; 
    margin-bottom: 40px;
    background: linear-gradient(135deg, #38bdf8, #818cf8);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
  }
  .section { 
    margin-bottom: 60px; 
    background: #1e293b; 
    border-radius: 16px; 
    padding: 32px;
    border: 1px solid #334155;
  }
  .section h2 { 
    font-size: 1.4rem; 
    margin-bottom: 20px; 
    color: #38bdf8;
  }
  .section p {
    color: #94a3b8;
    margin-bottom: 16px;
    font-size: 0.95rem;
  }
  .mermaid { 
    display: flex;
    justify-content: center;
    background: #fff; 
    border-radius: 12px; 
    padding: 30px;
    overflow: auto;
    cursor: grab;
  }
  .mermaid svg { 
    min-width: 800px;
    max-width: 100%;
    height: auto;
  }
  .tip {
    text-align: center;
    color: #64748b;
    margin-bottom: 30px;
    font-size: 0.9rem;
  }
  /* ç›®å½•ç»“æ„ç”¨ä»£ç å— */
  pre.dir-tree {
    background: #0f172a;
    color: #a5f3fc;
    padding: 24px;
    border-radius: 12px;
    font-size: 0.95rem;
    line-height: 1.6;
    overflow-x: auto;
    border: 1px solid #334155;
  }
</style>
</head>
<body>

<h1>ğŸ“ 02 ç³»ç»Ÿæ¶æ„ â€” å…¨è§ˆ</h1>
<p class="tip">ğŸ’¡ æç¤ºï¼šå¯ä»¥ç”¨ Ctrl + æ»šè½® ç¼©æ”¾æ•´ä¸ªé¡µé¢ï¼›æ¯å¼ å›¾éƒ½å¯ä»¥æ»šåŠ¨æŸ¥çœ‹</p>

<div class="section">
  <h2>ä¸€ã€é«˜å±‚ç³»ç»Ÿæ¶æ„</h2>
  <p>å±•ç¤ºæµè§ˆå™¨ç«¯ã€Vercel äº‘å¹³å°ã€å¤–éƒ¨æœåŠ¡ï¼ˆGmail / Google Sheets / reCAPTCHAï¼‰ä»¥åŠé™æ€èµ„æºä¹‹é—´çš„å…¨å±€å…³ç³»ã€‚</p>
  <div class="mermaid">
graph TB
    subgraph å®¢æˆ·ç«¯["ğŸŒ å®¢æˆ·ç«¯ï¼ˆæµè§ˆå™¨ï¼‰"]
        PAGE["é™æ€é¡µé¢\né¦–é¡µ / äº§å“ / å…³äº"]
        VIEWER3D["3D æŸ¥çœ‹å™¨\nreact-three-fiber"]
        VIEWER2D["2D å›¾çº¸æŸ¥çœ‹å™¨\nreact-zoom-pan-pinch"]
        FORM["è¯¢ç›˜è¡¨å•\nreact-hook-form + zod"]
    end

    subgraph VERCEL["â˜ï¸ Vercel"]
        CDN["å…¨çƒ CDN\né™æ€èµ„æºåˆ†å‘"]
        SSG["Next.js SSG\næ„å»ºæ—¶ç”Ÿæˆ HTML"]
        API["Serverless API\n/api/inquiry"]
    end

    subgraph å¤–éƒ¨æœåŠ¡["ğŸ“¡ å¤–éƒ¨æœåŠ¡"]
        GMAIL["Gmail\nnodemailer"]
        SHEETS["Google Sheets\nè¯¢ç›˜å½’æ¡£"]
        CAPTCHA["reCAPTCHA v3\næœºå™¨äººæ‹¦æˆª"]
    end

    subgraph é™æ€èµ„æº["ğŸ“ é™æ€èµ„æº"]
        GLB["3D æ¨¡å‹ .glb"]
        IMG["äº§å“å›¾ç‰‡"]
        DWG["2D å›¾çº¸ PNG/SVG"]
    end

    PAGE --> CDN
    VIEWER3D --> GLB
    VIEWER2D --> DWG
    CDN --> SSG
    GLB --> CDN
    IMG --> CDN
    DWG --> CDN
    FORM -->|POST| API
    API -->|å‘é€é€šçŸ¥| GMAIL
    API -->|å†™å…¥è¡Œ| SHEETS
    FORM -->|éªŒè¯| CAPTCHA
  </div>
</div>

<div class="section">
  <h2>äºŒã€é¡µé¢è·¯ç”±ç»“æ„</h2>
  <p>å¤šè¯­è¨€è·¯ç”±å±‚çº§ï¼Œä»¥åŠ 3D/2D æŸ¥çœ‹å™¨å’Œè¯¢ç›˜å¼¹çª—åœ¨äº§å“è¯¦æƒ…é¡µä¸­çš„åµŒå…¥å…³ç³»ã€‚</p>
  <div class="mermaid">
graph LR
    ROOT["/[locale]"] --> HOME["/ é¦–é¡µ"]
    ROOT --> PRODUCTS["/products äº§å“åˆ—è¡¨"]
    PRODUCTS --> DETAIL["/products/[id] äº§å“è¯¦æƒ…"]
    ROOT --> ABOUT["/about å…³äºæˆ‘ä»¬"]
    ROOT --> CONTACT["/contact è”ç³»/è¯¢ç›˜"]

    DETAIL -->|åµŒå…¥| V3D["3D æŸ¥çœ‹å™¨"]
    DETAIL -->|åµŒå…¥| V2D["2D å›¾çº¸æŸ¥çœ‹å™¨"]
    DETAIL -->|å¼¹çª—| INQUIRY["è¯¢ç›˜å¼¹çª—"]
    CONTACT -->|åŒ…å«| INQUIRY
  </div>
</div>

<div class="section">
  <h2>ä¸‰ã€è¯¢ç›˜æ•°æ®æµï¼ˆæ ¸å¿ƒä¸šåŠ¡æµç¨‹ï¼‰</h2>
  <p>ä»å®¢æˆ·å¡«å†™è¡¨å• â†’ reCAPTCHA éªŒè¯ â†’ å¹¶è¡Œå‘é€é‚®ä»¶é€šçŸ¥ + å†™å…¥ Google Sheets + è‡ªåŠ¨ç¡®è®¤å›å¤çš„å®Œæ•´æ—¶åºã€‚</p>
  <div class="mermaid">
sequenceDiagram
    actor å®¢æˆ·
    participant æµè§ˆå™¨
    participant reCAPTCHA
    participant API as /api/inquiry
    participant Gmail
    participant Sheets as Google Sheets

    å®¢æˆ·->>æµè§ˆå™¨: å¡«å†™è¯¢ç›˜è¡¨å•
    æµè§ˆå™¨->>reCAPTCHA: è¯·æ±‚éªŒè¯ Token
    reCAPTCHA-->>æµè§ˆå™¨: è¿”å› Token
    æµè§ˆå™¨->>API: POST è¡¨å•æ•°æ® + Token
    API->>reCAPTCHA: éªŒè¯ Token åˆæ³•æ€§
    reCAPTCHA-->>API: éªŒè¯é€šè¿‡ âœ…
    
    par å¹¶è¡Œæ‰§è¡Œ
        API->>Gmail: å‘é€è¯¢ç›˜é€šçŸ¥é‚®ä»¶ç»™ç®¡ç†å‘˜
        API->>Sheets: è¿½åŠ ä¸€è¡Œè¯¢ç›˜æ•°æ®
        API->>Gmail: å‘é€ç¡®è®¤é‚®ä»¶ç»™å®¢æˆ·
    end

    API-->>æµè§ˆå™¨: è¿”å›æˆåŠŸå“åº”
    æµè§ˆå™¨-->>å®¢æˆ·: æ˜¾ç¤ºæäº¤æˆåŠŸ
  </div>
</div>

<div class="section">
  <h2>å››ã€é¡¹ç›®ç›®å½•ç»“æ„</h2>
  <p>æ–‡ä»¶å¤¹å’Œå…³é”®æ–‡ä»¶çš„è§„åˆ’ã€‚</p>
  <pre class="dir-tree">
waimao-dulizhan/
â”œâ”€â”€ public/
â”‚   â”œâ”€â”€ models/           â† 3D æ¨¡å‹ (.glb)
â”‚   â”œâ”€â”€ drawings/         â† 2D å›¾çº¸ (.png/.svg)
â”‚   â””â”€â”€ images/           â† äº§å“ç…§ç‰‡ã€å…¬å¸å›¾ç‰‡
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ app/
â”‚   â”‚   â”œâ”€â”€ [locale]/     â† å¤šè¯­è¨€åŠ¨æ€è·¯ç”±
â”‚   â”‚   â”‚   â”œâ”€â”€ page.tsx           â† é¦–é¡µ
â”‚   â”‚   â”‚   â”œâ”€â”€ products/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ page.tsx       â† äº§å“åˆ—è¡¨
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ [id]/page.tsx  â† äº§å“è¯¦æƒ…
â”‚   â”‚   â”‚   â”œâ”€â”€ about/page.tsx     â† å…³äºæˆ‘ä»¬
â”‚   â”‚   â”‚   â””â”€â”€ contact/page.tsx   â† è”ç³»/è¯¢ç›˜
â”‚   â”‚   â”œâ”€â”€ api/
â”‚   â”‚   â”‚   â””â”€â”€ inquiry/route.ts   â† è¯¢ç›˜ API
â”‚   â”‚   â””â”€â”€ layout.tsx             â† å…¨å±€å¸ƒå±€
â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”œâ”€â”€ layout/        â† Header / Footer / Nav
â”‚   â”‚   â”œâ”€â”€ product/       â† ProductCard / ModelViewer / DrawingViewer
â”‚   â”‚   â”œâ”€â”€ inquiry/       â† InquiryForm / InquiryModal
â”‚   â”‚   â””â”€â”€ ui/            â† Button / Input ç­‰é€šç”¨ç»„ä»¶
â”‚   â”œâ”€â”€ lib/               â† å·¥å…·å‡½æ•°ï¼ˆé‚®ä»¶å‘é€ã€Sheets å†™å…¥ç­‰ï¼‰
â”‚   â”œâ”€â”€ data/              â† äº§å“æ•°æ® JSON
â”‚   â””â”€â”€ i18n/              â† ç¿»è¯‘å­—å…¸ en.json / zh.json
â”œâ”€â”€ doc/                   â† ğŸ“ æ¶æ„ç™½æ¿æ–‡æ¡£ï¼ˆä½ æ­£åœ¨çœ‹çš„ï¼‰
â””â”€â”€ content/               â† (é¢„ç•™) MDX å†…å®¹
  </pre>
</div>

<div class="section">
  <h2>äº”ã€ç»„ä»¶ä¾èµ–å…³ç³»</h2>
  <p>React ç»„ä»¶ä¹‹é—´è°å¼•ç”¨è°ï¼Œä»¥åŠç»„ä»¶ä¸ API / æœåŠ¡å±‚çš„è°ƒç”¨å…³ç³»ã€‚</p>
  <div class="mermaid">
graph TD
    Layout["RootLayout\nHeader + Footer + i18n Provider"]
    
    Layout --> HomePage
    Layout --> ProductList
    Layout --> ProductDetail
    Layout --> AboutPage
    Layout --> ContactPage

    ProductDetail --> ModelViewer["ModelViewer\nreact-three-fiber"]
    ProductDetail --> DrawingViewer["DrawingViewer\nreact-zoom-pan-pinch"]
    ProductDetail --> InquiryModal["InquiryModal"]
    
    ContactPage --> InquiryForm["InquiryForm\nreact-hook-form"]
    InquiryModal --> InquiryForm
    
    InquiryForm -->|POST| InquiryAPI["/api/inquiry"]
    InquiryAPI --> EmailService["lib/email.ts"]
    InquiryAPI --> SheetsService["lib/sheets.ts"]

    ProductList --> ProductCard
    HomePage --> ProductCard
    ProductCard -->|é“¾æ¥| ProductDetail
  </div>
</div>

<script>
  mermaid.initialize({ 
    startOnLoad: true, 
    theme: 'default',
    flowchart: { 
      useMaxWidth: false,
      htmlLabels: true,
      curve: 'basis'
    },
    sequence: {
      useMaxWidth: false,
      width: 200,
      height: 60
    }
  });
</script>

</body>
</html>
